// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.23;

import "forge-std/Test.sol";
import "forge-std/console2.sol";

import "contracts/OffchainOracle.sol";
import "deploy/foundry/deployments/DeployOffchainOracleBob.s.sol";

contract OffchainOracleBobTest is Test {
    DeployOffchainOracleBob public deploy;
    OffchainOracle public offchainOracle;
    MultiWrapper public multiWrapper;
    IOracle[] public oracles;

    function setUp() public {
        vm.createSelectFork("bob", 11664098);
        deploy = new DeployOffchainOracleBob();
        deploy.setUp();
        deploy.run();

        offchainOracle = deploy.offchainOracle();
        multiWrapper = deploy.multiWrapper();
        oracles = new IOracle[](1);
        oracles[0] = deploy.oracles(0);
    }

    function testDeploy() public view {
        assertNotEq(address(offchainOracle), address(0));
        assertNotEq(address(multiWrapper), address(0));
        assertNotEq(address(oracles[0]), address(0));
    }

    function testGetRate() public view {
        IERC20 srcToken = IERC20(0x4200000000000000000000000000000000000006); //weth
        IERC20 dstToken = IERC20(0xe75D0fB2C24A55cA1e3F96781a2bCC7bdba058F0); //usdc

        uint256 weightedRate = offchainOracle.getRate({srcToken: srcToken, dstToken: dstToken, useWrappers: false});

        assertEq(weightedRate, 3688650413);
    }
}
